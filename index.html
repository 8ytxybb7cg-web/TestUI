<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Travel Sync System</title>

  <!-- =========================
       VERSION
       ========================= -->
  <!-- 顯示於 UI：行程標題上方（細灰字）及底部置中 -->
  <meta name="app-version" content="v5.10-testUI" />

  <!-- =========================
       BASE STYLE（不改動既有視覺比例）
       ========================= -->
  <style>
    :root {
      --text-main: #ffffff;
      --text-muted: rgba(255,255,255,0.55);
      --bg-main: #0f172a;
      --bg-header: rgba(15,23,42,0.85);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                   Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    /* =========================
       HEADER
       ========================= */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-header);
      backdrop-filter: blur(10px);
      padding: 12px 16px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .header-top {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .header-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .trip-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* 語言切換（localStorage） */
    .lang-toggle {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 6px;
      background: rgba(255,255,255,0.08);
      cursor: pointer;
      user-select: none;
    }

    .lang-toggle.active {
      background: rgba(255,255,255,0.18);
    }

    .user-icon {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
    }

    /* =========================
       MAIN WRAPPER
       ========================= */
    main {
      padding: 16px;
    }

    /* =========================
       FOOTER
       ========================= */
    footer {
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      padding: 20px 0 28px;
    }
  </style>

  <!-- =========================
       SUPABASE
       ========================= -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    /* Supabase 設定（testUI row 已存在） */
    const SUPABASE_URL = "https://myrhatzdypiwwgmmfbuw.supabase.co";
    const SUPABASE_KEY = "sb_publishable_bnnah-2fsCaQnKZDoKNJQw_NuYQVvKi";

    const supabase = supabase.createClient(
      SUPABASE_URL,
      SUPABASE_KEY
    );

    const TRIP_TABLE = "trip_data";
    const TRIP_ROW_ID = "testUI";
  </script>
</head>

<body>

  <!-- =========================
       HEADER UI
       ========================= -->
  <header>
    <!-- 版本顯示（細灰字，上方） -->
    <div class="header-top">
      TRAVEL SYNC SYSTEM · v5.10-testUI
    </div>

    <div class="header-main">
      <!-- 原本行程標題，完全保留 -->
      <div class="trip-title">
        CURRENT TRIP · HKG → KIX
      </div>

      <!-- 右側：語言切換 + 用戶圖示 -->
      <div class="header-actions">
        <div id="lang-zh" class="lang-toggle">繁中</div>
        <div id="lang-en" class="lang-toggle">EN</div>
        <div class="user-icon"></div>
      </div>
    </div>
  </header>

  <!-- =========================
       MAIN CONTENT（後續段落填入）
       ========================= -->
  <main id="app">
    <!-- Part 2 由此開始 -->
  </main>

  <!-- =========================
       FOOTER VERSION
       ========================= -->
  <footer>
    TRAVEL SYNC SYSTEM<br/>
    v5.10-testUI
  </footer>

  <!-- =========================
       LANGUAGE (localStorage)
       ========================= -->
  <script>
    const langButtons = {
      zh: document.getElementById("lang-zh"),
      en: document.getElementById("lang-en")
    };

    function applyLanguage(lang) {
      localStorage.setItem("ui_lang", lang);
      langButtons.zh.classList.toggle("active", lang === "zh");
      langButtons.en.classList.toggle("active", lang === "en");
      document.documentElement.lang = lang === "zh" ? "zh-HK" : "en-GB";
    }

    const savedLang = localStorage.getItem("ui_lang") || "zh";
    applyLanguage(savedLang);

    langButtons.zh.onclick = () => applyLanguage("zh");
    langButtons.en.onclick = () => applyLanguage("en");
  </script>

<!-- =========================
     PART 1 END
     ========================= -->

<!-- =========================
     PART 2 / 4
     FLIGHT CARD（HKG / iOS SKIN 共存）
     ========================= -->

<style>
  /* =========================
     FLIGHT CARD – COMMON
     ========================= */
  .flight-card {
    border-radius: 18px;
    overflow: hidden;
    margin-bottom: 18px;
  }

  /* =========================
     HKG SKIN（只影響 HKG）
     ========================= */
  .flight-card.hkg {
    background: #1f2937;
  }

  /* Skin toggle（修正：不再只影響 header） */
  .skin-toggle {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 8px;
    font-size: 11px;
    color: rgba(255,255,255,0.6);
  }

  .skin-toggle span {
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
  }

  .skin-toggle span.active {
    background: rgba(255,255,255,0.18);
  }

  /* =========================
     HKG – GATE SECTION (3.2)
     ========================= */
  .hkg-gate {
    background: #353e53;
    color: #e9eb4f;
    text-align: center;
    padding: 16px 0;
    font-size: 26px;
    font-weight: 600;
    letter-spacing: 1px;
  }

  /* =========================
     HKG – INFO SECTION (3.3)
     ========================= */
  .hkg-info {
    background: #bf443b;
    color: #ffffff;
    padding: 12px 14px;
    font-size: 12px;
    line-height: 1.4;
  }

  .hkg-info .row {
    margin-bottom: 4px;
  }

  .hkg-info .row:last-child {
    margin-bottom: 0;
  }

  /* =========================
     iOS SKIN（完全不受影響）
     ========================= */
  .flight-card.ios {
    background: linear-gradient(135deg,#3b82f6,#2563eb);
    padding: 14px;
    font-size: 13px;
  }

</style>

<!-- =========================
     SKIN TOGGLE（只切 Flight Card）
     ========================= -->
<div class="skin-toggle">
  <span id="skin-hkg" class="active">HKG</span>
  <span id="skin-ios">iOS</span>
</div>

<!-- =========================
     FLIGHT CARD
     ========================= -->
<div id="flightCard" class="flight-card hkg">

  <!-- HKG SKIN -->
  <div class="hkg-skin">

    <!-- 登機閘口（置中） -->
    <div class="hkg-gate">
      24
    </div>

    <!-- 下方資訊區 -->
    <div class="hkg-info">
      <div class="row">CABIN · ECONOMY</div>
      <div class="row">HKG T1 to KIX</div>
      <div class="row">21 DEC</div>
    </div>

  </div>

  <!-- iOS SKIN -->
  <div class="ios-skin" style="display:none;">
    Gate 24 · Economy<br/>
    HKG → KIX · 21 Dec
  </div>

</div>

<script>
  /* =========================
     SKIN TOGGLE LOGIC
     ========================= */
  const flightCard = document.getElementById("flightCard");
  const skinHkgBtn = document.getElementById("skin-hkg");
  const skinIosBtn = document.getElementById("skin-ios");

  const hkgSkin = flightCard.querySelector(".hkg-skin");
  const iosSkin = flightCard.querySelector(".ios-skin");

  function applySkin(skin) {
    if (skin === "hkg") {
      flightCard.classList.add("hkg");
      flightCard.classList.remove("ios");
      hkgSkin.style.display = "block";
      iosSkin.style.display = "none";
      skinHkgBtn.classList.add("active");
      skinIosBtn.classList.remove("active");
    } else {
      flightCard.classList.add("ios");
      flightCard.classList.remove("hkg");
      hkgSkin.style.display = "none";
      iosSkin.style.display = "block";
      skinHkgBtn.classList.remove("active");
      skinIosBtn.classList.add("active");
    }
    localStorage.setItem("flight_skin", skin);
  }

  const savedSkin = localStorage.getItem("flight_skin") || "hkg";
  applySkin(savedSkin);

  skinHkgBtn.onclick = () => applySkin("hkg");
  skinIosBtn.onclick = () => applySkin("ios");
</script>

<!-- =========================
     PART 2 END
     ========================= -->

<!-- =========================
     PART 3 / 4
     TRIP DATA + SUPABASE (testUI)
     ========================= -->

<style>
  /* =========================
     SECTION COMMON
     ========================= */
  .section {
    margin-bottom: 22px;
  }

  .section-title {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 10px;
    color: rgba(255,255,255,0.85);
  }

  .card {
    background: rgba(255,255,255,0.06);
    border-radius: 14px;
    padding: 14px;
    font-size: 12px;
    line-height: 1.5;
  }

  .card + .card {
    margin-top: 10px;
  }
</style>

<!-- =========================
     TRIP SECTION
     ========================= -->
<div class="section" id="tripSection">
  <div class="section-title" data-i18n="tripTitle">
    行程資料
  </div>

  <div class="card" id="tripContent">
    Loading...
  </div>
</div>

<script>
  /* =========================
     SUPABASE LOAD
     ========================= */
  async function loadTripData() {
    const { data, error } = await supabase
      .from(TRIP_TABLE)
      .select("*")
      .eq("id", TRIP_ROW_ID)
      .single();

    if (error || !data) {
      console.warn("Supabase 讀取失敗，使用 localStorage");
      return loadLocalTrip();
    }

    localStorage.setItem("trip_cache_testUI", JSON.stringify(data));
    renderTrip(data);
  }

  function loadLocalTrip() {
    const cached = localStorage.getItem("trip_cache_testUI");
    if (cached) {
      renderTrip(JSON.parse(cached));
    } else {
      document.getElementById("tripContent").innerText =
        "無法載入行程資料";
    }
  }

  function renderTrip(data) {
    /* 假設 testUI row 已包含欄位：
       title / start_date / end_date / notes */
    const html = `
      <strong>${data.title || "HKG → KIX"}</strong><br/>
      ${data.start_date || ""} – ${data.end_date || ""}<br/><br/>
      ${data.notes || ""}
    `;
    document.getElementById("tripContent").innerHTML = html;
  }

  loadTripData();
</script>

<!-- =========================
     I18N TEXT（localStorage）
     ========================= -->
<script>
  const i18n = {
    zh: {
      tripTitle: "行程資料"
    },
    en: {
      tripTitle: "Trip Information"
    }
  };

  function applyI18n() {
    const lang = localStorage.getItem("ui_lang") || "zh";
    document
      .querySelectorAll("[data-i18n]")
      .forEach(el => {
        const key = el.dataset.i18n;
        el.innerText = i18n[lang][key] || el.innerText;
      });
  }

  applyI18n();
</script>

<!-- =========================
     PART 3 END
     ========================= -->

<!-- =========================
     PART 4 / 4
     FINAL INIT + EOF
     ========================= -->

<script>
  /* =========================
     GLOBAL INIT
     ========================= */

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      // 回到頁面時可重新同步
      loadTripData();
    }
  });

  /* =========================
     SAFETY CHECK
     ========================= */
  console.info(
    "Travel Sync System v5.10-testUI loaded",
    {
      lang: localStorage.getItem("ui_lang"),
      skin: localStorage.getItem("flight_skin")
    }
  );
</script>

<!-- =========================
     END OF FILE
     ========================= -->

</body>
</html>
